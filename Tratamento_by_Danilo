Tratamento de erros, mudanças aplicadas para que o código funcione
